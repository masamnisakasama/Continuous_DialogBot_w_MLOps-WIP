# WebApp_Continuous_DialogBot_w_MLOps(WIP)

## 概要
このプロジェクトは自動修正付きプレゼン練習ボットです。<br>
ある人の喋った内容やネット上の音声などを解析し、プレゼンテーション能力などを定量化します。具体的には構造性、話すスピード、抑揚などをスコアリングします。
現在はMLOps無しで一旦Webアプリにした感じです。
アプリにした後は、プレゼン音声と成約可否のラベルつき擬似データを作ってMLOpsする予定です。
**基本GPT-5 ThinkingとClaude Opus 4.1でUIや機能の大枠を作っています。とりあえず一回LLMにコードをみてもらいますが、依存関係が複雑だと大抵バグる（し、特にChat GPT-5 はたまにバグが悪化します。）バグが治らなそうなところは自分で見て書き直しています。**

## 想定ユースケースおよびアプリのイメージ画像
- ベテラン社員のプレゼンテーション等を解析し、スキルセットを明文化することで促販や他者へのプレゼンなどに役立てる。（CHAT GPT-5を適宜用いて、スコアリングの詳細を詰めていくことでスピーチ能力を定量化しています。）<br>
- また需要を考え、単純にスピーチが練習アプリとしても使えるようにしています。<br>
<br><br>


## アプリのURLおよび注意事項
MLOps無しでのWeb AppのURL（**平日9:05–21:00 JST**で10倍以上速いかつ正確): https://roaring-pavlova-76f278.netlify.app<br><br>
MLOps有りでのWeb AppのURL：<br><br>

＜改善点＞<br>
- 速いバージョンではCPUの代わりにGPU(Pytorch 2.5.1 + CUDA 12.1 + NVIDIA L4)を用いております。
- 速いバージョンではPostgreSQL in CloudSQLを用いています。
- 速いバージョンではWhisperのモデルにturbo(以前のmediumより正確)を用いています。
- 速いバージョンではヘルスチェック機能があります。ネット環境が悪いとランプが赤色に変わります。

<br><br>＜注意＞<br>


- **コストと相談した結果、9:05–21:00 JSTではインスタンス常時起動で早く、それ以外の時間帯では基本的にインスタンス０で使えないようにしてあります。需要をダッシュボードで鑑み、土日はインスタンス０でいきます**
- CRON Jobがうまくいっていないのか、朝9時にうまくGPUが起動されないことがあります。warmup/エンドポイントがないのが原因なので、そのうち足してリビルドする可能性があります。
- 音声の解析中は別のことをしていても問題なく動いていますので、していただいて構いません。
- ファイルサイズはWhisper APIの処理の関係上24 MBまでです。
- また、短い音声で簡単に高得点が取れないよう、ペナルティーが入るようになっています。１０００文字程度話していただくと減点はほぼなくなります。
- 何を入れるか迷ったら、私のレポジトリから「ずんだもんITプレゼン例」の**mp3**の音声ファイルをとってきて分析するといいと思います。<br><br>


## アーキテクチャ図
私自身も混乱し始めたので一旦アーキテクチャ図を作りました。<br>
<img width="6330" height="3775" alt="Dialogbot_revised2_GPU" src="https://github.com/user-attachments/assets/1893bf56-ca16-4a80-9035-157a35f6b8f9" />





## 主な機能
🎙️ 音声からテキストへ (STT) : Whisper API を利用した文字起こし<br>
🧠 スコアリング : 構造性・一貫性・冗長性（密度）・CTA などを LLM で評価<br>
⏱️ 音声指標 : 発話速度、文節の長さなどの簡易指標<br>
🖥️ Web UI : React 製のシンプルな解析フロントエンド<br>
🗣️プロンプト :企業名や特有サービスなどの固有名詞を設定することで音声認識の精度を上げられます　<br>
☁️ 保存 : 将来のMLOps再学習に向けた S3 等への保存に対応（WIP）<br><br>

## 技術スタック
- Fast API / 会話ログを収取し、各種分析を行う**バックエンド**
- React / WebアプリのUIコンポーネントの構築をする**フロントエンド**
- Whisper API(Open AI API) / STT(Speech to Text)により、音声をテキストに変換
- Open AI API　/ スピーチの内容からムードやスタイル、興味を算出する
- Cloud Run + Netlify /　バックエンドのサーバレスデプロイサービス + フロントエンドデプロイ用のサービス
- (予定)Pub/Sub、BigQuery、GCS / ドリフト検知・再学習などMLOps<br><br>
Cloud Runについては上限メモリ16 GiB, HTTPリクエスト上限1時間となっています。<br>
S3については、一時期分析結果を表示していたものの、セキュリティーの観点からフロントエンド側から見れないようにしました。<br>将来のMLOpsへの拡張のために集計自体はされているものの、デフォルトで暗号化が効いてますし、中身ももちろん見ませんのでご安心ください。<br>
<フロントエンドに結果を表示していた頃の画像><br>
<img width="1425" height="401" alt="Screenshot 2025-08-15 at 14 36 43" src="https://github.com/user-attachments/assets/d5e13411-e3cf-4a8b-8a35-03e038e59769" />


## 反省点
- アイデアドリブンの開発は途中で行き詰まることが多い。まず扱うテーマ(今回は音声学やセールスの話) についてML以外の関連文献をよく調べ、可能かどうか十分に判断してから始めるべき。
- 教師なし学習でMLOPsは普通に難しいので、ラベル付きのデータセットがない状態で開発するのはダメ🙅。今回の売り上げ予測については成約可否のラベルがないので難しい。
- 難しい指標を導入して結果的にわかりにくくなることが多い。SHAPを用いるより発話速度、発話の間隔などを可視化する方が直感的にわかりやすく、使う人にとって有用になる。
- 依存関係やモジュールがグチャグチャになりがち。都度リファクタリングした方が良い。（本心を言うとコードレビューなどあれば良いが個人開発なのでそれは難しいか？）
- 実際にWebアプリとして動かす際はスケーリングや処理能力の問題が存在する。特にWhisper APIを動かすとどうしてもメモリ処理能力やHTTPリクエストの処理制限時間を超え、タイムアウトしがち。
- ローカル環境で大体のメモリ使用量/HTTPリクエストの処理時間を測り、用いるバックエンドのデプロイサービスを見極める必要がある。
- Renderならメモリは512 MBしかないが、これだと最小モデルのTinyすら動かない。（RenderでWhisper APIを使いたい場合は重課金するしかない？）
  

## スコアリングの例
試行錯誤を重ね、良いプレゼンと悪いプレゼンの定量化を行いました。<br>想定ケースは「会社内のRAGの活用サービスを売り込むプレゼンテーション」です。<br>（他意はなく、CHAT GPT-5に最近何かとSNSなどでよく見るRAGの活用例を求めたところ、このような出力がなされました。）<br>どのような音声入力をしたのかに関しては、「ずんだもんITプレゼン例」の音声ファイルやテキストファイルをご覧ください。

低いスコアの例　<br>
<img width="1406" height="234" alt="Screenshot 2025-08-13 at 14 35 46" src="https://github.com/user-attachments/assets/6a1cad10-bb43-4531-b109-63a4b4af6501" />
<img width="1436" height="569" alt="Screenshot 2025-08-13 at 14 36 42" src="https://github.com/user-attachments/assets/1ecd855c-0ca8-4c9d-81f7-be34a3fb0dbb" />
<img width="1436" height="507" alt="Screenshot 2025-08-13 at 14 37 00" src="https://github.com/user-attachments/assets/8d077fd1-ddbc-48ba-adc5-0dc883bd6d19" />
<br>

高いスコアの例　<br>
<img width="1440" height="214" alt="Screenshot 2025-08-13 at 14 52 32" src="https://github.com/user-attachments/assets/9add4f3f-154a-4d11-9bab-0b6423bedef9" />
<img width="1440" height="656" alt="Screenshot 2025-08-13 at 14 53 19" src="https://github.com/user-attachments/assets/947a339c-2546-432c-acbd-d410e785565b" />
<br>

## レポについて
GPUを用いた版のレポは、バックエンドが「dialogbot-api_w_GPU」に、フロントエンドが「dialogbot-frontend_w_GPU 」に入っています。

## ライセンスについて
このプロジェクトは MIT License の下で公開されています。

---


質問や疑問点などがあれば気軽にどうぞ！

